!function(t){"use strict";t.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:"<small>Loading...</small>",loadingFunction:!1,padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",callback:!1}};t.fn.jscroll=function(n){return this.each((function(){var l=t(this),e=l.data("jscroll");e&&e.initialized||function(n,l){var e,o=n.data("jscroll"),r="function"==typeof l?{callback:l}:l,i=t.extend({},t.jscroll.defaults,r,o||{}),c="visible"===n.css("overflow-y"),a=n.find(i.nextSelector).first(),s=t(window),d=t("body"),f=c?s:n,g=t.trim(a.prop("href")+" "+i.contentSelector),u=function(){n.find(".jscroll-inner").length||n.contents().wrapAll('<div class="jscroll-inner" />')},p=function(t){i.pagingSelector?t.closest(i.pagingSelector).hide():t.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide().length||t.wrap('<div class="jscroll-next-parent" />').parent().hide()},j=function(){return f.unbind(".jscroll").removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()},h=function(){if(n.is(":visible")){u();var t=n.find("div.jscroll-inner").first(),l=n.data("jscroll"),e=parseInt(n.css("borderTopWidth"),10),o=isNaN(e)?0:e,r=parseInt(n.css("paddingTop"),10)+o,a=c?f.scrollTop():n.offset().top,s=t.length?t.offset().top:0,d=Math.ceil(a-s+f.height()+r);if(!l.waiting&&d+i.padding>=t.outerHeight())return m("info","jScroll:",t.outerHeight()-d,"from bottom. Loading next request..."),b()}},v=function(){var l=n.find(i.nextSelector).first();if(l.length)if(i.autoTrigger&&(!1===i.autoTriggerUntil||0<i.autoTriggerUntil)){p(l);var e=d.height()-n.offset().top;(n.height()<e?n.height():e)<=(0<n.offset().top-s.scrollTop()?s.height()-(n.offset().top-t(window).scrollTop()):s.height())&&h(),f.unbind(".jscroll").bind("scroll.jscroll",(function(){return h()})),0<i.autoTriggerUntil&&i.autoTriggerUntil--}else f.unbind(".jscroll"),l.bind("click.jscroll",(function(){return p(l),b(),!1}))},b=function(){var l=n.find("div.jscroll-inner").first(),e=n.data("jscroll");return e.waiting=!0,l.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading" id="jscroll-loading">'+i.loadingHtml+"</div>").promise().done((function(){i.loadingFunction&&i.loadingFunction()})),n.animate({scrollTop:l.outerHeight()},0,(function(){var o=e.nextHref;l.find("div.jscroll-added").last().load(o,(function(l,r){if("error"===r)return j();var c,a=t(this).find(i.nextSelector).first();e.waiting=!1,e.nextHref=!!a.prop("href")&&t.trim(a.prop("href")+" "+i.contentSelector),t(".jscroll-next-parent",n).remove(),(c=c||n.data("jscroll"))&&c.nextHref?v():(m("warn","jScroll: nextSelector not found - destroying"),j()),i.callback&&i.callback.call(this,o),m("dir",e)}))}))},m=function(t){if(i.debug&&"object"==typeof console&&("object"==typeof t||"function"==typeof console[t]))if("object"==typeof t){var n=[];for(var l in t)"function"==typeof console[l]?(n=t[l].length?t[l]:[t[l]],console[l].apply(console,n)):console.log.apply(console,n)}else console[t].apply(console,Array.prototype.slice.call(arguments,1))};n.data("jscroll",t.extend({},o,{initialized:!0,waiting:!1,nextHref:g})),u(),(e=t(i.loadingHtml).filter("img").attr("src"))&&((new Image).src=e),v(),t.extend(n.jscroll,{destroy:j})}(l,n)}))}}(jQuery);
